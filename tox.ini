[tox]
envlist =
    py310-rarfile40-py7zr0220,
    py310-rarfile42-py7zr100rc3,
    py310-rarfilelatest-py7zrlatest,
    py310-rarfilenotinstalled-py7zrnotinstalled,
    py313-rarfilelatest-py7zrlatest,
    py314beta-rarfilelatest-py7zrlatest,
    latest-rarfilelatest-py7zrlatest
skip_missing_interpreters = True

[testenv]
deps =
    # For most environments, install with optional dependencies
    py310-rarfile42-py7zr100rc3: .[optional]
    py310-rarfilelatest-py7zrlatest: .[optional]
    py313-rarfilelatest-py7zrlatest: .[optional]
    py314beta-rarfilelatest-py7zrlatest: .[optional]
    latest-rarfilelatest-py7zrlatest: .[optional]
    # For specific older versions or no-install cases, install base package only or not at all
    py310-rarfile40-py7zr0220: . # Install base package
    # For notinstalled cases, .[optional] would pull them in, so just install pytest
    py310-rarfilenotinstalled-py7zrnotinstalled: # No package, just pytest

    pytest
    lz4>=4.4.4 # Needed by sample_archives.py for test collection
    zstandard>=0.23.0 # Needed by sample_archives.py for test collection
    # rarfile versions
    rarfile40: rarfile==4.0
    rarfile42: rarfile==4.2
    rarfilelatest: rarfile
    # py7zr versions
    py7zr0220: py7zr==0.22.0
    py7zr100rc3: py7zr==1.0.0rc3
    py7zrlatest: py7zr
    # No rarfile/py7zr for the 'notinstalled' cases
    rarfilenotinstalled:
    py7zrnotinstalled:
commands =
    sudo apt-get update
    sudo apt-get install -y unrar
    pytest tests/archivey/test_read_archives.py
setenv =
    PYTHONPATH = {toxinidir}/src
passenv = *
allowlist_externals =
    sudo
    apt-get
