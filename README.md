# Archivey

Archivey helps you read many common archive formats through one consistent interface. It builds on Python's standard library (and a few optional extras) and fills in the gaps those libraries leave behind.


## Features

- Automatic file format detection
- Support for ZIP, TAR (including compressed tar variants), RAR and 7z files, and single-file compressed formats
- Optimized streaming access reading of archive members
- Consistent handling of symlinks, file times, permissions, and passwords
- Consistent exception hierarchy

## Installation

Install with pip:
```
pip install archivey[optional]
```
If you'd rather manage dependencies yourself, install only the extras you need. RAR support requires the `unrar` tool to be available.

| Format | Builtin module | Python package | System requirement |
| --- | --- | --- | --- |
| ZIP archives | `zipfile` | | |
| TAR archives | `tarfile` | | |
| RAR archives | | [`rarfile`](https://pypi.org/project/rarfile)<br>[`cryptography`](https://pypi.org/project/cryptography) (for encrypted headers) | `unrar` binary |
| 7z archives | | [`py7zr`](https://pypi.org/project/py7zr) | |
| Gzip |`gzip` | [`rapidgzip`](https://pypi.org/project/rapidgzip) (multithreaded decompression and random access) | |
| Bzip2 | `bz2` | [`indexed_bzip2`](https://pypi.org/project/indexed-bzip2) (multithreaded decompression and random access) | |
| XZ | `lzma` | [`python-xz`](https://pypi.org/project/python-xz) (random access) | |
| Zstandard | | [`pyzstd`](https://pypi.org/project/pyzstd) (preferred) or [`zstandard`](https://pypi.org/project/zstandard) | |
| LZ4 | | [`lz4`](https://pypi.org/project/lz4) | |

## Usage

### Streaming access
```python
from archivey import open_archive

with open_archive("example.zip") as archive:
    for member, stream in archive.iter_members_with_io():
        print(member.filename, member.file_size)
        if stream:
            data = stream.read()
```

### Random access
```python
from archivey import open_archive

with open_archive("example.zip") as archive:
    members = archive.get_members()
    # Read the contents of the last file in the archive
    member_to_read = members[-1]
    if member_to_read.is_file:
        stream = archive.open(member_to_read)
        data = stream.read()
```

### Configuration
You can enable optional features by passing an `ArchiveyConfig` to `open_archive`.

```python
from archivey import open_archive, ArchiveyConfig

config = ArchiveyConfig(use_rar_stream=True, use_rapidgzip=True)
with open_archive("file.rar", config=config) as archive:
    ...
```

### Single-file compressed streams

To open a standalone compressed file (e.g., `.gz` or `.xz`) and work with the
uncompressed data, use `open_compressed_stream`:

```python
from archivey import open_compressed_stream

with open_compressed_stream("example.txt.gz") as f:
    data = f.read()
```

Like `open_archive`, this helper accepts an optional `ArchiveyConfig` to enable
alternative decompression libraries.

See the user guide for more options.

## Command line usage

Archivey comes with a small command line tool, also named `archivey`.
You can run it directly or via `python -m archivey`.
It's handy for quick checks and experiments rather than heavy-duty archive management.

```bash
archivey my_archive.zip
archivey --extract --dest out_dir my_archive.zip
```

You can filter member names using shell patterns placed after `--`:

```bash
archivey --list my_archive.zip -- "*.txt"
```

---

## Documentation

For more detailed information on using and extending `archivey`, please refer to the following resources:

*   **[User Guide](docs/user_guide.md)**: Learn how to use `archivey` to open and interact with archives.
*   **[Developer Guide](docs/developer_guide.md)**: Information on adding support for new archive formats by creating custom `ArchiveReader` implementations.
*   **[API Reference](docs/api/archivey/index.html)**: Detailed documentation of all public classes, methods, and functions (generated by pdoc).


## Future plans

*   [UNIX compress format](https://en.wikipedia.org/wiki/Compress_(software)) (`.Z`),
*   [ar archives](https://en.wikipedia.org/wiki/Ar_(Unix)) (`.ar`, `.deb`)
*   [ISO images](https://en.wikipedia.org/wiki/Optical_disc_image) (`.iso`)
*   Add [libarchive](https://pypi.org/project/libarchive/) as a backend, see what it allows us to do
*   Support streaming access for ZIP archives (similar approach to [`stream-unzip`](http://pypi.org/project/stream-unzip))
*   Support [builtin Zstandard](https://docs.python.org/3.14/whatsnew/3.14.html#whatsnew314-pep784) in Python 3.14
*   Auto-select libraries or implementations to use based on what is installed and/or required features
*   Archive writing support
*   Bug: ZIP filename decoding can be wrong in some cases (see [sample archive](tests/test_archives_external/encoding_infozip_jules.zip))
*   Split the [IO wrappers](src/archivey/internal/io_helpers.py) into a separate library, as it seems to be generally useful
